import{a as x}from"./chunk-FEAEIRQH.mjs";import{e as B,f as P}from"./chunk-H25LABEO.mjs";import{b as p,d as k}from"./chunk-KQCDLWYO.mjs";import{e as b}from"./chunk-4RHYZ7KP.mjs";import{a as h}from"./chunk-AGDFKPNM.mjs";import{d as w}from"./chunk-5M2OMQDL.mjs";async function R(o){let{cedraConfig:t,options:n}=o;return k({cedraConfig:t,originMethod:"getTransactions",path:"transactions",params:{start:n?.offset,limit:n?.limit}})}async function W(o){let{cedraConfig:t}=o;return x(async()=>{let{data:n}=await p({cedraConfig:t,originMethod:"getGasPriceEstimation",path:"estimate_gas_price"});return n},`gas-price-${t.network}`,1e3*60*5)()}async function O(o){let{cedraConfig:t,ledgerVersion:n}=o,{data:e}=await p({cedraConfig:t,originMethod:"getTransactionByVersion",path:`transactions/by_version/${n}`});return e}async function y(o){let{cedraConfig:t,transactionHash:n}=o,{data:e}=await p({cedraConfig:t,path:`transactions/by_hash/${n}`,originMethod:"getTransactionByHash"});return e}async function q(o){let{cedraConfig:t,transactionHash:n}=o;try{return(await y({cedraConfig:t,transactionHash:n})).type==="pending_transaction"}catch(e){if(e?.status===404)return!0;throw e}}async function V(o){let{cedraConfig:t,transactionHash:n}=o,{data:e}=await p({cedraConfig:t,path:`transactions/wait_by_hash/${n}`,originMethod:"longWaitForTransaction"});return e}async function z(o){let{cedraConfig:t,transactionHash:n,options:e}=o,r=e?.timeoutSecs??20,g=e?.checkSuccess??!0,i=!0,d=0,s,f,u=200,m=1.5;function c(a){if(!(a instanceof b)||(f=a,a.status!==404&&a.status>=400&&a.status<500))throw a}try{s=await y({cedraConfig:t,transactionHash:n}),i=s.type==="pending_transaction"}catch(a){c(a)}if(i){let a=Date.now();try{s=await V({cedraConfig:t,transactionHash:n}),i=s.type==="pending_transaction"}catch(T){c(T)}d=(Date.now()-a)/1e3}for(;i&&!(d>=r);){try{if(s=await y({cedraConfig:t,transactionHash:n}),i=s.type==="pending_transaction",!i)break}catch(a){c(a)}await h(u),d+=u/1e3,u*=m}if(s===void 0)throw f||new l(`Fetching transaction ${n} failed and timed out after ${r} seconds`,s);if(s.type==="pending_transaction")throw new l(`Transaction ${n} timed out in pending state after ${r} seconds`,s);if(!g)return s;if(!s.success)throw new C(`Transaction ${n} failed with an error: ${s.vm_status}`,s);return s}async function U(o){let{cedraConfig:t,processorType:n}=o,e=BigInt(o.minimumLedgerVersion),r=3e3,g=new Date().getTime(),i=BigInt(-1);for(;i<e;){if(new Date().getTime()-g>r)throw new Error("waitForLastSuccessIndexerVersionSync timeout");if(n===void 0?i=await B({cedraConfig:t}):i=(await P({cedraConfig:t,processorType:n})).last_success_version,i>=e)break;await h(200)}}var l=class extends Error{constructor(t,n){super(t),this.lastSubmittedTransaction=n}},C=class extends Error{constructor(t,n){super(t),this.transaction=n}};async function X(o){let{cedraConfig:t,ledgerVersion:n,options:e}=o,{data:r}=await p({cedraConfig:t,originMethod:"getBlockByVersion",path:`blocks/by_version/${n}`,params:{with_transactions:e?.withTransactions}});return H({block:r,...o})}async function j(o){let{cedraConfig:t,blockHeight:n,options:e}=o,{data:r}=await p({cedraConfig:t,originMethod:"getBlockByHeight",path:`blocks/by_height/${n}`,params:{with_transactions:e?.withTransactions}});return H({block:r,...o})}async function H(o){let{cedraConfig:t,block:n,options:e}=o;if(e?.withTransactions){n.transactions=n.transactions??[];let r=n.transactions[n.transactions.length-1],g=BigInt(n.first_version),i=BigInt(n.last_version),d=r?.version,s;if(d===void 0?s=g-1n:s=BigInt(d),s===i)return n;let f=[],u=100n;for(let c=s+1n;c<i;c+=BigInt(100))f.push(R({cedraConfig:t,options:{offset:c,limit:Math.min(Number(u),Number(i-c+1n))}}));let m=await Promise.all(f);for(let c of m)n.transactions.push(...c)}return n}export{R as a,W as b,O as c,y as d,q as e,V as f,z as g,U as h,l as i,C as j,X as k,j as l};
//# sourceMappingURL=chunk-B33LCAJF.mjs.map