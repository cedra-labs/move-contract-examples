import{spawn as u}from"child_process";import{platform as g}from"os";var p=class{async init(e){let{network:o,profile:t,extraArguments:s,showStdout:a}=e,r=["cedra","init",`--network=${o??"local"}`,`--profile=${t??"default"}`];return s&&r.push(...s),this.runCommand(r,a)}async compile(e){let{packageDirectoryPath:o,namedAddresses:t,extraArguments:s,showStdout:a}=e,r=["cedra","move","compile","--package-dir",o],d=this.parseNamedAddresses(t);return r.push(...this.prepareNamedAddresses(d)),s&&r.push(...s),this.runCommand(r,a)}async test(e){let{packageDirectoryPath:o,namedAddresses:t,extraArguments:s,showStdout:a}=e,r=["cedra","move","test","--package-dir",o],d=this.parseNamedAddresses(t);return r.push(...this.prepareNamedAddresses(d)),s&&r.push(...s),this.runCommand(r,a)}async publish(e){let{packageDirectoryPath:o,namedAddresses:t,profile:s,extraArguments:a,showStdout:r}=e,d=["cedra","move","publish","--package-dir",o,`--profile=${s??"default"}`],n=this.parseNamedAddresses(t);return d.push(...this.prepareNamedAddresses(n)),a&&d.push(...a),this.runCommand(d,r)}async createObjectAndPublishPackage(e){let{packageDirectoryPath:o,addressName:t,namedAddresses:s,profile:a,extraArguments:r,showStdout:d}=e,n=["cedra","move","create-object-and-publish-package","--package-dir",o,"--address-name",t,`--profile=${a??"default"}`],i=this.parseNamedAddresses(s);n.push(...this.prepareNamedAddresses(i)),r&&n.push(...r);let{output:c}=await this.runCommand(n,d);return{objectAddress:this.extractAddressFromOutput(c)}}async upgradeObjectPackage(e){let{packageDirectoryPath:o,objectAddress:t,namedAddresses:s,profile:a,extraArguments:r,showStdout:d}=e,n=["cedra","move","upgrade-object-package","--package-dir",o,"--object-address",t,`--profile=${a??"default"}`],i=this.parseNamedAddresses(s);return n.push(...this.prepareNamedAddresses(i)),r&&n.push(...r),this.runCommand(n,d)}async buildPublishPayload(e){let{outputFile:o,packageDirectoryPath:t,namedAddresses:s,extraArguments:a,showStdout:r}=e,d=["cedra","move","build-publish-payload","--json-output-file",o,"--package-dir",t],n=this.parseNamedAddresses(s);return d.push(...this.prepareNamedAddresses(n)),a&&d.push(...a),this.runCommand(d,r)}async runScript(e){let{compiledScriptPath:o,profile:t,extraArguments:s,showStdout:a}=e,r=["cedra","move","run-script","--compiled-script-path",o,`--profile=${t??"default"}`];return s&&r.push(...s),this.runCommand(r,a)}async gasProfile(e){let{network:o,transactionId:t,extraArguments:s,showStdout:a}=e,r=["cedra","move","replay","--profile-gas","--network",o,"--txn-id",t];return s&&r.push(...s),this.runCommand(r,a)}async runCommand(e,o=!0){return new Promise((t,s)=>{let a=g(),r,d="",n="";a==="win32"?r=u("npx",e,{shell:!0}):r=u("npx",e),r.stdout.on("data",i=>{n=i.toString(),d+=i.toString()}),o&&(r.stdout.pipe(process.stdout),r.stderr.pipe(process.stderr)),process.stdin.pipe(r.stdin),r.on("close",i=>{if(i===0)try{let c=JSON.parse(n);c.Error?s(new Error(`Error: ${c.Error}`)):c.Result&&t({result:c.Result,output:d})}catch{t({output:d})}else s(new Error(`Child process exited with code ${i}`))})})}prepareNamedAddresses(e){let o=e.size,t=[];if(o===0)return t;t.push("--named-addresses");let s=[];return e.forEach((a,r)=>{let d=`${r}=${a.toString()}`;s.push(d)}),t.push(s.join(",")),t}parseNamedAddresses(e){let o=new Map;return Object.keys(e).forEach(t=>{let s=e[t];o.set(t,s)}),o}extractAddressFromOutput(e){let o=e.match("Code was successfully deployed to object address (0x[0-9a-fA-F]+)");if(o)return o[1];throw new Error("Failed to extract object address from output")}};export{p as a};
//# sourceMappingURL=chunk-HBOHVKOD.mjs.map